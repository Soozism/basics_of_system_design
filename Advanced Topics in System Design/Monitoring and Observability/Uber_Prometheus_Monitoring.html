<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>استفاده اوبر از Prometheus برای مانیتورینگ و مشاهده‌پذیری در سیستم‌های مقیاس بزرگ</title>
    <link rel="stylesheet" href="../../css/style.css">
    <meta name="description" content="استفاده اوبر از Prometheus برای مانیتورینگ و مشاهده‌پذیری در سیستم‌های مقیاس بزرگ">
    <meta name="keywords" content="طراحی سیستم, مهندسی نرم‌افزار, معماری سیستم">
</head>
<body>
    <header>
        <div class="header-content">
            <a href="../../index.html" class="logo">طراحی سیستم</a>
            <nav>
                <ul class="nav-menu">
                    <li><a href="../../index.html">خانه</a></li>
                    <li><a href="../../index.html#basic-concepts">مفاهیم پایه</a></li>
                    <li><a href="../../index.html#main-components">اجزای اصلی</a></li>
                    <li><a href="../../index.html#scalable-systems">سیستم‌های مقیاس‌پذیر</a></li>
                    <li><a href="../../index.html#advanced-topics">موضوعات پیشرفته</a></li>
                    <li><a href="../../index.html#interviews">مصاحبه</a></li>
                </ul>
            </nav>
            <button class="mobile-menu-toggle">☰</button>
        </div>
    </header>

    <div class="container">
        <main class="main-content">
            <aside class="sidebar">
                
    <h3>استفاده اوبر از Prometheus برای مانیتورینگ و مشاهده‌پذیری در سیستم‌های مقیاس بزرگ</h3>
    <ul>
        <li><a href="../../../index.html">بازگشت به خانه</a></li>
        <li><a href="../../../index.html#basic-concepts">مفاهیم پایه</a></li>
        <li><a href="../../../index.html#main-components">اجزای اصلی</a></li>
        <li><a href="../../../index.html#scalable-systems">سیستم‌های مقیاس‌پذیر</a></li>
        <li><a href="../../../index.html#advanced-topics">موضوعات پیشرفته</a></li>
        <li><a href="../../../index.html#interviews">آمادگی مصاحبه</a></li>
    </ul>
    
            </aside>

            <article class="content">
                <div class="breadcrumb">
                    <a href="index.html">خانه</a>
<span>/</span>
<span>Advanced Topics in System Design</span>
<span>/</span>
<span>Monitoring and Observability</span>
<span>/</span>
<span>Uber_Prometheus_Monitoring.html</span>
                </div>

                <h1>استفاده اوبر از Prometheus برای مانیتورینگ و مشاهده‌پذیری در سیستم‌های مقیاس بزرگ</h1>

<h2>مرور کلی بر چالش‌های مانیتورینگ اوبر در مقیاس بزرگ</h2>

<p>اوبر به‌عنوان یکی از بزرگ‌ترین پلتفرم‌های اشتراک سفر، با بیش از ۴,۰۰۰ میکروسرویس اختصاصی و مجموعه‌ای از فناوری‌های متن‌باز مانند MySQL، Cassandra، Redis، Kafka و ZooKeeper، با چالش‌های عظیمی در مانیتورینگ مواجه است. این چالش‌ها عبارت‌اند از:</p>

<ul><li><strong>حجم عظیم داده‌ها</strong>: اوبر روزانه میلیاردها معیار (Metrics) تولید می‌کند، از جمله معیارهای مربوط به عملکرد برنامه‌ها، زیرساخت‌ها و رفتار کاربران در صدها شهر.</li></ul>
<ul><li><strong>معماری توزیع‌شده</strong>: سیستم‌های اوبر در مراکز داده محلی، AWS و Google Cloud Platform (GCP) اجرا می‌شوند، که نیاز به مشاهده‌پذیری جهانی و یکپارچه را ایجاد می‌کند.</li></ul>
<ul><li><strong>پیچیدگی میکروسرویس‌ها</strong>: با بیش از ۴,۰۰۰ میکروسرویس، رصد هر سرویس به‌صورت جداگانه و شناسایی گلوگاه‌ها یا خطاها چالش‌برانگیز است.</li></ul>
<ul><li><strong>نیاز به هشداردهی بلادرنگ</strong>: اوبر باید به‌سرعت مشکلات را شناسایی و هشدار دهد تا از قطعی سرویس‌ها یا تأثیر بر کاربران جلوگیری کند.</li></ul>
<ul><li><strong>رشد سریع</strong>: با رشد ۱۰ برابری سالانه در حجم داده‌ها، سیستم‌های مانیتورینگ قدیمی مانند Graphite و Nagios دیگر مقیاس‌پذیر نبودند.</li></ul>

<p>این چالش‌ها اوبر را وادار کرد تا به‌دنبال راه‌حل‌های مدرن و مقیاس‌پذیر مانند <strong>Prometheus</strong> برای مانیتورینگ و مشاهده‌پذیری باشد.</p>

<p>---</p>

<h2>چرا اوبر Prometheus را انتخاب کرد؟</h2>

<p>اوبر در سال ۲۰۱۴ با مشکلاتی در استفاده از Graphite و Nagios مواجه شد، از جمله پیچیدگی در نگهداری، عدم مقیاس‌پذیری، و مشکلات در هشداردهی دقیق. دلایل انتخاب Prometheus عبارت‌اند از:</p>

<ul><li><strong>مدل داده چندبعدی</strong>: Prometheus از یک مدل داده مبتنی بر برچسب (Labels) استفاده می‌کند که امکان تحلیل دقیق معیارها را فراهم می‌کند.</li></ul>
<ul><li><strong>زبان پرس‌وجوی قدرتمند (PromQL)</strong>: PromQL امکان پرس‌وجوهای پیچیده و تحلیل داده‌های سری زمانی را به‌صورت بلادرنگ فراهم می‌کند.</li></ul>
<ul><li><strong>مقیاس‌پذیری برای محیط‌های Cloud-Native</strong>: Prometheus برای معماری‌های میکروسرویس و Kubernetes طراحی شده است، که با زیرساخت اوبر هم‌راستا بود.</li></ul>
<ul><li><strong>جامعه متن‌باز فعال</strong>: به‌عنوان پروژه‌ای تحت Cloud Native Computing Foundation (CNCF)، Prometheus از پشتیبانی گسترده‌ای برخوردار است و با ابزارهای متن‌باز دیگر ادغام می‌شود.</li></ul>
<ul><li><strong>سادگی عملیات</strong>: باینری‌های مستقل و بدون وابستگی به ذخیره‌سازی توزیع‌شده، استقرار Prometheus را ساده می‌کنند.</li></ul>

<p>راب اسکیلینگتون، سرپرست فنی مانیتورینگ در اوبر، اظهار داشت: «کتابخانه‌های کلاینت و ویژگی‌های Prometheus همان چیزی بود که مهندسان اوبر می‌خواستند با آن کار کنند.»<a href="https://www.cncf.io/case-studies/uber/"></a></p>

<p>---</p>

<h2>ادغام Prometheus در معماری سیستم اوبر</h2>

<p>اوبر Prometheus را به‌عنوان بخشی از پلتفرم <strong>M3</strong> خود، که یک راه‌حل متن‌باز برای ذخیره‌سازی و پرس‌وجوی معیارهای مقیاس‌پذیر است، ادغام کرده است. معماری ادغام به‌صورت زیر است:</p>

<ul><li><strong>جمع‌آوری معیارها</strong>:</li></ul>
   - Prometheus از مدل Pull استفاده می‌کند و معیارها را از نقاط پایانی HTTP (مانند <code>/metrics</code>) جمع‌آوری می‌کند.
   - سرویس‌های اوبر و ابزارهای متن‌باز (مانند MySQL، Kafka) از اکسپورترهای Prometheus (مانند node_exporter) برای ارائه معیارها استفاده می‌کنند.

<ul><li><strong>ذخیره‌سازی و مقیاس‌پذیری با M3</strong>:</li></ul>
   - به دلیل محدودیت‌های مقیاس‌پذیری Prometheus در ذخیره‌سازی تک‌نود، اوبر پلتفرم M3 را توسعه داد که شامل <strong>M3DB</strong> (پایگاه داده سری زمانی توزیع‌شده) و <strong>M3 Coordinator</strong> است.
   - M3DB معیارها را در خوشه‌های ذخیره‌سازی توزیع‌شده ذخیره می‌کند و امکان پرس‌وجوی جهانی در مراکز داده مختلف را فراهم می‌کند.
   - M3 Coordinator برای نمونه‌برداری (Downsampling)، تجمیع، و اعمال سیاست‌های نگه‌داری (Retention) استفاده می‌شود.

<ul><li><strong>پایپ‌لاین پردازش معیارها</strong>:</li></ul>
   - معیارها از سرویس‌ها به M3 ارسال می‌شوند، تجمیع شده و در M3DB ذخیره می‌شوند.
   - Prometheus برای جمع‌آوری و پردازش اولیه معیارها و Alertmanager برای مدیریت هشدارها استفاده می‌شود.

<ul><li><strong>تجسم و داشبوردسازی</strong>:</li></ul>
   - اوبر از <strong>Grafana</strong> برای نمایش معیارهای جمع‌آوری‌شده توسط Prometheus در داشبوردهای تعاملی استفاده می‌کند.
   - داشبوردهای Grafana برای رصد سلامت سرورها، عملکرد برنامه‌ها، و معیارهای تجاری (مانند تعداد سفرها در شهرها) استفاده می‌شوند.

<ul><li><strong>هشداردهی</strong>:</li></ul>
   - اوبر از <strong>uMonitor</strong> و <strong>Neris</strong> برای هشداردهی مبتنی بر معیارها و بررسی‌های میزبان استفاده می‌کند.
   - <strong>Origami</strong>، یک پلتفرم اختصاصی، برای کاهش نویز هشدارها و تجمیع اعلان‌ها در سناریوهای پیچیده (مانند قطعی‌های چندشهری) استفاده می‌شود.<a href="https://www.uber.com/blog/observability-at-scale/"></a>

<p>---</p>

<h2>ویژگی‌های کلیدی Prometheus که اوبر از آن‌ها بهره می‌برد</h2>

<p>اوبر از ویژگی‌های زیر Prometheus برای بهبود مشاهده‌پذیری و مانیتورینگ استفاده می‌کند:</p>

<ul><li><strong>جمع‌آوری معیارها</strong>:</li></ul>
   - Prometheus معیارهای عددی (مانند تعداد درخواست‌های HTTP، تأخیر سرویس، یا مصرف CPU) را به‌صورت سری زمانی با برچسب‌های چندبعدی جمع‌آوری می‌کند.
   - مثال: معیار <code>http_requests_total</code> برای رصد تعداد درخواست‌های API.

<ul><li><strong>زبان پرس‌وجوی PromQL</strong>:</li></ul>
   - PromQL امکان تحلیل‌های پیچیده مانند نرخ خطا، تأخیر صدک (Percentile Latency)، یا مقایسه معیارها در بازه‌های زمانی را فراهم می‌کند.
   - مثال: پرس‌وجوی <code>rate(http_requests_total[5m])</code> برای محاسبه نرخ درخواست‌ها در ۵ دقیقه.

<ul><li><strong>هشداردهی با Alertmanager</strong>:</li></ul>
   - اوبر قوانین هشدار را در Prometheus تعریف می‌کند و Alertmanager اعلان‌ها را به Slack، PagerDuty یا ایمیل ارسال می‌کند.
   - مثال: هشدار برای افزایش نرخ خطای یک سرویس یا قطعی در یک مرکز داده.

<ul><li><strong>پشتیبانی از اکسپورترها</strong>:</li></ul>
   - اوبر از اکسپورترهای Prometheus (مانند node_exporter برای معیارهای سیستم و mysqld_exporter برای MySQL) برای رصد ابزارهای متن‌باز استفاده می‌کند.

<ul><li><strong>کشف سرویس پویا (Service Discovery)</strong>:</li></ul>
   - Prometheus با Kubernetes و سایر پلتفرم‌های ابری ادغام می‌شود تا سرویس‌های جدید را به‌صورت خودکار کشف کند.

<p>---</p>

<h2>نمونه‌های واقعی از موارد استفاده یا حوادث</h2>

<ul><li><strong>مانیتورینگ در اوج بار هالووین ۲۰۱۵</strong>:</li></ul>
   - اوبر در هالووین ۲۰۱۵، که دومین رویداد اوج بار سالانه پس از سال نو بود، از M3 و Prometheus برای مانیتورینگ استفاده کرد. این اولین باری بود که سیستم مشاهده‌پذیری اوبر در چنین رویدادی بدون قطعی عمل کرد.<a href="https://newsletter.pragmaticengineer.com/p/how-uber-built-its-observability-platform"></a>
   - Prometheus معیارهای بلادرنگ مانند تعداد سفرها و تأخیر سرویس‌ها را رصد کرد و هشدارهای فوری برای مشکلات احتمالی ارائه داد.

<ul><li><strong>مانیتورینگ معیارهای تجاری</strong>:</li></ul>
   - تیم پرداخت‌های اوبر (Rider Payments) از Prometheus و M3 برای رصد معیارهای تجاری مانند نرخ موفقیت پرداخت‌ها در شهرهای مختلف و پلتفرم‌های iOS و Android استفاده کرد.<a href="https://newsletter.pragmaticengineer.com/p/how-uber-built-its-observability-platform"></a>
   - این امر به شناسایی سریع مشکلات پرداخت و بهبود تجربه کاربری کمک کرد.

<ul><li><strong>تشخیص ناهنجاری‌ها</strong>:</li></ul>
   - اوبر از Prometheus برای شناسایی ناهنجاری‌ها در معیارهای سرویس‌ها، مانند افزایش ناگهانی نرخ خطا یا تأخیر، استفاده می‌کند. این اطلاعات برای عیب‌یابی سریع و جلوگیری از قطعی‌ها حیاتی است.

<p>---</p>

<h2>چگونه Prometheus به بهبود قابلیت اطمینان و عملکرد سیستم اوبر کمک می‌کند</h2>

<ul><li><strong>قابلیت اطمینان</strong>:</li></ul>
   - Prometheus امکان رصد بلادرنگ سلامت سرویس‌ها و زیرساخت‌ها را فراهم می‌کند، که به اوبر کمک می‌کند تا قبل از تأثیر بر کاربران، مشکلات را شناسایی کند.
   - سیستم هشداردهی Alertmanager با کاهش نویز و ارائه اعلان‌های دقیق، زمان واکنش به حوادث را کاهش می‌دهد.

<ul><li><strong>عملکرد</strong>:</li></ul>
   - با استفاده از PromQL، اوبر می‌تواند گلوگاه‌های عملکرد (مانند تأخیر در APIها یا مصرف بالای منابع) را شناسایی و بهینه‌سازی کند.
   - داشبوردهای Grafana به تیم‌ها امکان می‌دهند تا معیارهای کلیدی را به‌صورت بصری تحلیل کنند.

<ul><li><strong>مقیاس‌پذیری</strong>:</li></ul>
   - ادغام با M3 امکان ذخیره‌سازی و پرس‌وجوی معیارها در مقیاس بزرگ (بیش از ۶.۶ میلیارد سری زمانی و ۵۰۰ میلیون معیار در ثانیه) را فراهم می‌کند.<a href="https://www.cncf.io/case-studies/uber/"></a>
   - این امر هزینه‌های ذخیره‌سازی را ۸.۵۳ برابر بهینه‌تر کرده و زمان راه‌اندازی سیستم‌های مانیتورینگ را ۴ برابر سریع‌تر کرده است.<a href="https://www.cncf.io/case-studies/uber/"></a>

<ul><li><strong>کاهش بار عملیاتی</strong>:</li></ul>
   - اوبر تعداد اعلان‌های فوری و غیرفوری را از ۲۵ در هفته (برای Cassandra) به ۱.۵ با M3DB کاهش داد، که نشان‌دهنده کاهش ۱۶.۶۷ برابری بار عملیاتی است.<a href="https://www.cncf.io/case-studies/uber/"></a>

<p>---</p>

<h2>درس‌های آموخته‌شده و بهترین روش‌های اوبر برای مانیتورینگ</h2>

<ul><li><strong>ساخت سیستم‌های مقیاس‌پذیر</strong>:</li></ul>
   - اوبر دریافت که ابزارهای قدیمی مانند Graphite برای مقیاس‌های بزرگ مناسب نیستند. توسعه M3 برای رفع محدودیت‌های Prometheus در ذخیره‌سازی بلندمدت، مقیاس‌پذیری را بهبود بخشید.

<ul><li><strong>کاهش نویز هشدارها</strong>:</li></ul>
   - استفاده از Origami برای تجمیع و کاهش نویز هشدارها، به‌ویژه در سناریوهای پیچیده مانند قطعی‌های چندشهری، حیاتی است.<a href="https://www.uber.com/blog/observability-at-scale/"></a>
   - قوانین هشدار باید دقیق و معنی‌دار باشند تا از هشدارهای غیرضروری جلوگیری شود.

<ul><li><strong>ادغام با اکوسیستم متن‌باز</strong>:</li></ul>
   - اوبر از اکسپورترهای Prometheus برای ابزارهای متن‌باز مانند Kafka و MySQL استفاده می‌کند، که ادغام را ساده‌تر می‌کند.

<ul><li><strong>مانیتورینگ جهانی</strong>:</li></ul>
   - پرس‌وجوهای بین‌مراکز داده‌ای (Cross-Data Center) امکان مشاهده‌پذیری جهانی را فراهم می‌کنند، که برای عملیات جهانی اوبر ضروری است.

<ul><li><strong>آزمایش و شبیه‌سازی</strong>:</li></ul>
   - اوبر سناریوهای اوج بار (مانند هالووین) را شبیه‌سازی می‌کند تا اطمینان حاصل کند که سیستم مانیتورینگ در شرایط بحرانی عملکرد خوبی دارد.

<ul><li><strong>تمرکز بر تجربه توسعه‌دهندگان</strong>:</li></ul>
   - اوبر ابزارهایی مانند uMonitor را توسعه داد تا رابط‌های کاربری برای ویرایش و عیب‌یابی معیارها ارائه دهد، که تجربه توسعه‌دهندگان را بهبود می‌بخشد.

<p>---</p>

<h2>مشارکت‌های متن‌باز و نوآوری‌های اوبر در ارتباط با Prometheus</h2>

<p>اوبر مشارکت‌های قابل‌توجهی در اکوسیستم Prometheus داشته است، به‌ویژه با توسعه و متن‌باز کردن پلتفرم <strong>M3</strong>:</p>

<ul><li><strong>M3 و M3DB</strong>:</li></ul>
   - اوبر پلتفرم M3 را به‌عنوان یک ذخیره‌سازی مقیاس‌پذیر و چندمنظوره برای معیارهای Prometheus متن‌باز کرد.<a href="https://www.uber.com/en-FI/blog/m3/"></a>
   - <strong>M3DB</strong> یک پایگاه داده سری زمانی توزیع‌شده است که معیارها را با نگه‌داری بلندمدت ذخیره می‌کند و از پرس‌وجوهای کم‌تأخیر پشتیبانی می‌کند.
   - <strong>M3 Coordinator</strong> امکان نمونه‌برداری، تجمیع و اعمال سیاست‌های نگه‌داری را فراهم می‌کند.

<ul><li><strong>مزایای M3</strong>:</li></ul>
   - مقیاس‌پذیری: پشتیبانی از ۶.۶ میلیارد سری زمانی و ۵۰۰ میلیون معیار در ثانیه.
   - تحمل‌پذیری خطا: با ذخیره‌سازی توزیع‌شده و افزونگی، از دست رفتن داده‌ها جلوگیری می‌شود.
   - سازگاری با ابزارهای قدیمی: پشتیبانی از معیارهای StatsD و Graphite برای مهاجرت آسان.

<ul><li><strong>مشارکت در جامعه متن‌باز</strong>:</li></ul>
   - اوبر از جامعه برای دریافت بازخورد و مشارکت در توسعه M3 دعوت کرده و کد منبع آن را در GitHub منتشر کرده است.<a href="https://www.uber.com/en-FI/blog/m3/"></a>
   - این پلتفرم به شرکت‌های دیگر امکان می‌دهد تا از راه‌حل‌های مقیاس‌پذیر اوبر برای مانیتورینگ استفاده کنند.

<ul><li><strong>نوآوری در هشداردهی</strong>:</li></ul>
   - اوبر ابزارهایی مانند <strong>Origami</strong> را برای مدیریت هشدارهای پیچیده توسعه داد، که نویز را کاهش داده و اعلان‌ها را به‌صورت تجمیعی ارائه می‌دهد.<a href="https://www.uber.com/blog/observability-at-scale/"></a>

<p>---</p>

<h2>خلاصه نقش Prometheus در مشاهده‌پذیری اوبر</h2>

<strong>Prometheus</strong> به اوبر کمک کرده است تا چالش‌های مانیتورینگ در مقیاس بزرگ را با موفقیت مدیریت کند. با استفاده از مدل داده چندبعدی، زبان پرس‌وجوی PromQL، و قابلیت‌های هشداردهی، اوبر می‌تواند سلامت سرویس‌ها، زیرساخت‌ها و معیارهای تجاری را به‌صورت بلادرنگ رصد کند. ادغام Prometheus با پلتفرم M3 امکان ذخیره‌سازی مقیاس‌پذیر و پرس‌وجوهای جهانی را فراهم کرده است، که هزینه‌ها را کاهش داده و قابلیت اطمینان را بهبود بخشیده است.

<p>نمونه‌های واقعی مانند مدیریت اوج بار هالووین ۲۰۱۵ و رصد معیارهای پرداخت نشان‌دهنده تأثیر Prometheus در عملیات اوبر است. مشارکت‌های متن‌باز اوبر، به‌ویژه M3 و M3DB، به جامعه فناوری کمک کرده تا راه‌حل‌های مشابهی را پیاده‌سازی کنند. بهترین روش‌های اوبر، مانند کاهش نویز هشدارها، ادغام با ابزارهای متن‌باز، و تمرکز بر مقیاس‌پذیری، درس‌های ارزشمندی برای طراحی سیستم‌های مانیتورینگ امن و قابل اعتماد ارائه می‌دهند. این رویکردها برای مهندسان نرم‌افزار که به‌دنبال ساخت سیستم‌های مقیاس‌پذیر هستند، الهام‌بخش است.</p>

                <div class="alert alert-info" style="margin-top: 2rem;">
                    <strong>نکته:</strong> این مطلب بخشی از مجموعه آموزش طراحی سیستم است. برای مطالعه سایر مطالب، از منوی کناری استفاده کنید.
                </div>
            </article>
        </main>
    </div>

    <footer>
        <div class="footer-content">
            <p>&copy; 2024 آموزش طراحی سیستم - تمام حقوق محفوظ است</p>
            <p>آخرین به‌روزرسانی: 2025-07-12</p>
        </div>
    </footer>

    <script src="../../js/script.js"></script>
</body>
</html>