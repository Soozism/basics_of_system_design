# نمونه‌های واقعی: استفاده از DynamoDB در آمازون و MongoDB در اینستاگرام

این سند به بررسی دو نمونه واقعی از استفاده پایگاه‌های داده NoSQL در مقیاس بزرگ، یعنی **DynamoDB** در آمازون و **MongoDB** در اینستاگرام، می‌پردازد. هدف این است که با ارائه جزئیات فنی، دلایل انتخاب این پایگاه‌های داده، موارد استفاده، تصمیمات طراحی، و درس‌های معماری، یک راهنمای جامع و آموزشی برای یادگیری طراحی سیستم‌های مقیاس‌پذیر فراهم شود. این محتوا به زبان فارسی و با فرمت مارک‌داون ارائه شده است تا برای مستندسازی آموزشی و یادگیری اصول طراحی سیستم مناسب باشد.

---

## مقدمه: اهمیت مطالعه موردی‌های واقعی در طراحی سیستم

مطالعات موردی واقعی از شرکت‌های بزرگ مانند آمازون و اینستاگرام، نقش مهمی در درک چگونگی پیاده‌سازی فناوری‌های پایگاه داده در محیط‌های مقیاس بزرگ دارند. این مطالعات به ما کمک می‌کنند تا:

- **تصمیمات طراحی را درک کنیم:** انتخاب پایگاه داده مناسب و تریدآف‌های مرتبط با آن.
- **چالش‌های مقیاس‌پذیری را بشناسیم:** نحوه مدیریت بارهای کاری سنگین و رشد سریع داده‌ها.
- **بهترین روش‌ها را یاد بگیریم:** استفاده از تکنیک‌های بهینه برای عملکرد، دسترسی‌پذیری و هزینه.
- **درس‌های عملی بیاموزیم:** از موفقیت‌ها و شکست‌های شرکت‌های پیشرو در فناوری.

این سند به بررسی استفاده آمازون از DynamoDB و اینستاگرام از MongoDB می‌پردازد تا نشان دهد چگونه این پایگاه‌های داده نیازهای برنامه‌های مقیاس بزرگ را برآورده می‌کنند.

---

## آمازون و DynamoDB

### چرا آمازون از DynamoDB استفاده می‌کند؟
**DynamoDB** یک پایگاه داده NoSQL کاملاً مدیریت‌شده و بدون سرور است که توسط آمازون وب سرویس (AWS) توسعه یافته است. آمازون DynamoDB را برای پاسخ به نیازهای داخلی خود برای یک پایگاه داده مقیاس‌پذیر، با دسترسی‌پذیری بالا و عملکرد قابل پیش‌بینی طراحی کرد. دلایل اصلی انتخاب DynamoDB عبارتند از:
- **مقیاس‌پذیری افقی:** DynamoDB به‌طور خودکار داده‌ها را بین پارتیشن‌ها تقسیم می‌کند و با افزایش بار کاری مقیاس می‌شود.
- **دسترسی‌پذیری بالا:** با تکرار چندمنطقه‌ای (Multi-Region Replication) و SLA دسترسی‌پذیری 99.999%.
- **عملکرد ثابت:** ارائه تأخیر تک‌رقمی میلی‌ثانیه‌ای حتی در مقیاس‌های عظیم.
- **مدیریت آسان:** به‌عنوان یک سرویس بدون سرور، نیاز به مدیریت زیرساخت را حذف می‌کند.

### نحوه مدیریت مقیاس‌پذیری، دسترسی‌پذیری و عملکرد
- **مقیاس‌پذیری:** DynamoDB از پارتیشن‌بندی خودکار استفاده می‌کند. داده‌ها بر اساس کلید پارتیشن (Partition Key) بین گره‌های ذخیره‌سازی توزیع می‌شوند، که امکان مقیاس‌پذیری افقی را فراهم می‌کند. با استفاده از حالت ظرفیت درخواستی (On-Demand Capacity Mode)، DynamoDB به‌طور خودکار ظرفیت را بر اساس بار تنظیم می‌کند.[](https://docs.aws.amazon.com/whitepapers/latest/big-data-analytics-options/amazon-dynamodb.html)
- **دسترسی‌پذیری:** DynamoDB از جداول جهانی (Global Tables) برای تکرار داده‌ها در چندین منطقه AWS استفاده می‌کند، که دسترسی‌پذیری و تحمل خطا را تضمین می‌کند. هر پارتیشن دارای سه گره است که یکی از آن‌ها گره رهبر (Leader Node) است و عملیات نوشتن را هماهنگ می‌کند.[](https://en.wikipedia.org/wiki/Amazon_DynamoDB)
- **عملکرد:** استفاده از دیسک‌های SSD و کش در حافظه (مانند DynamoDB Accelerator یا DAX) تأخیر را به میکروثانیه کاهش می‌دهد.[](https://medium.com/%40christopheradamson253/deep-dive-into-aws-dynamodb-a-nosql-database-for-high-performance-applications-4c80d1410533)

### موارد استفاده خاص در آمازون
1. **سبد خرید (Shopping Cart):**
   - DynamoDB برای ذخیره‌سازی داده‌های سبد خرید در آمازون استفاده می‌شود، که نیاز به تأخیر کم و مقیاس‌پذیری بالا در زمان‌های اوج ترافیک (مانند Black Friday) دارد.
   - **مثال:** در رویداد Prime Day 2021، DynamoDB بیش از ۸۹.۲ میلیون درخواست در ثانیه را پردازش کرد و عملکرد تک‌رقمی میلی‌ثانیه‌ای را حفظ کرد.[](https://www.usenix.org/conference/atc22/presentation/elhemali)
2. **پیگیری سفارشات (Order Tracking):**
   - DynamoDB داده‌های مربوط به وضعیت سفارشات را ذخیره می‌کند، که نیاز به دسترسی سریع و به‌روزرسانی‌های مداوم دارد.
   - **ویژگی‌ها:** مدل داده‌ای کلید-مقدار (Key-Value) امکان دسترسی سریع به داده‌های سفارش بر اساس کلید پارتیشن (مانند OrderID) را فراهم می‌کند.
3. **متادیتای محتوا:** آمازون از DynamoDB برای ذخیره‌سازی متادیتای محتوا در سرویس‌هایی مانند Prime Video استفاده می‌کند، که نیاز به دسترسی سریع و مقیاس‌پذیری برای میلیون‌ها کاربر دارد.[](https://aws.amazon.com/blogs/database/amazon-dynamodb-use-cases-for-media-and-entertainment-customers/)

### تصمیمات طراحی و تریدآف‌ها
- **تصمیمات طراحی:**
  - **مدل داده‌ای بدون طرح‌واره (Schemaless):** DynamoDB نیازی به تعریف طرح‌واره ندارد، که توسعه سریع و انعطاف‌پذیری را ممکن می‌کند.
  - **کلید پارتیشن و مرتب‌سازی:** انتخاب کلید پارتیشن مناسب (مانند UserID) و کلید مرتب‌سازی (مانند OrderDate) برای بهینه‌سازی پرس‌وجوها حیاتی است.[](https://www.hellointerview.com/learn/system-design/deep-dives/dynamodb)
  - **DAX (DynamoDB Accelerator):** برای برنامه‌های خواندن سنگین، DAX کش در حافظه را فراهم می‌کند و تأخیر را کاهش می‌دهد.
- **تریدآف‌ها:**
  - **عدم پشتیبانی از Join:** DynamoDB از عملیات Join پشتیبانی نمی‌کند، بنابراین داده‌ها باید Denormalize شوند، که ممکن است طراحی مدل داده را پیچیده کند.[](https://docs.aws.amazon.com/whitepapers/latest/big-data-analytics-options/amazon-dynamodb.html)
  - **هزینه در مقیاس بزرگ:** در حالت درخواستی، هزینه‌ها ممکن است برای بارهای کاری غیرقابل پیش‌بینی افزایش یابد. حالت ظرفیت رزروشده (Provisioned) برای بارهای کاری قابل پیش‌بینی مقرون‌به‌صرفه‌تر است.
  - **پیچیدگی در پرس‌وجوهای پیچیده:** پرس‌وجوهای پیچیده نیاز به ایندکس‌های ثانویه (Secondary Indexes) یا ابزارهای مکمل مانند Amazon Redshift دارند.

---

## اینستاگرام و MongoDB

### چرا اینستاگرام MongoDB را انتخاب کرد؟
**MongoDB** یک پایگاه داده NoSQL مبتنی بر سند (Document-Based) است که اینستاگرام آن را برای مدیریت داده‌های بدون طرح‌واره و مقیاس‌پذیر انتخاب کرد. دلایل اصلی انتخاب MongoDB عبارتند از:
- **انعطاف‌پذیری طرح‌واره:** امکان ذخیره‌سازی داده‌های متنوع (مانند پروفایل‌های کاربران و متادیتای تصاویر) بدون نیاز به طرح‌واره ثابت.
- **مقیاس‌پذیری افقی:** پشتیبانی از شاردینگ برای توزیع داده‌ها بین سرورها.
- **عملکرد بالا:** مناسب برای برنامه‌های بلادرنگ با ترافیک بالا.
- **جامعه و اکوسیستم قوی:** MongoDB به‌عنوان یک پایگاه داده منبع‌باز (تا حدی) و با پشتیبانی از Atlas (سرویس مدیریت‌شده)، انعطاف‌پذیری بالایی ارائه می‌دهد.

### موارد استفاده در اینستاگرام
1. **ذخیره‌سازی متادیتای تصاویر:**
   - اینستاگرام از MongoDB برای ذخیره‌سازی متادیتای تصاویر (مانند توضیحات، برچسب‌ها، و اطلاعات مکان) استفاده می‌کند.
   - **ویژگی‌ها:** مدل داده‌ای مبتنی بر سند امکان ذخیره‌سازی داده‌های نیمه‌ساختارمند (مانند JSON) را فراهم می‌کند، که برای متادیتای تصاویر مناسب است.
2. **پروفایل‌های کاربران:**
   - داده‌های پروفایل کاربران (مانند نام، بیوگرافی، و دنبال‌کنندگان) در MongoDB ذخیره می‌شوند.
   - **مزیت:** انعطاف‌پذیری طرح‌واره به اینستاگرام اجازه می‌دهد تا ویژگی‌های جدیدی (مانند Stories) را بدون تغییر طرح‌واره اضافه کند.
3. **مدیریت فیدهای اجتماعی:**
   - MongoDB برای ذخیره‌سازی داده‌های مربوط به فیدهای کاربران (مانند پست‌های اخیر) استفاده می‌شود، که نیاز به دسترسی سریع و مقیاس‌پذیری دارد.

### مزایای انعطاف‌پذیری طرح‌واره و مقیاس‌پذیری
- **انعطاف‌پذیری طرح‌واره:**
  - MongoDB به اینستاگرام امکان می‌دهد تا داده‌های متنوع و پویا را بدون نیاز به تعریف ستون‌های ثابت ذخیره کند.
  - **مثال:** افزودن ویژگی‌هایی مانند Reels یا Stories بدون نیاز به تغییر ساختار پایگاه داده.
- **مقیاس‌پذیری:**
  - MongoDB از شاردینگ افقی پشتیبانی می‌کند، که داده‌ها را بر اساس کلید شارد (مانند UserID) بین گره‌ها توزیع می‌کند.
  - اینستاگرام از شاردینگ برای مدیریت میلیاردها پست و کاربر استفاده می‌کند، که امکان مقیاس‌پذیری خطی را فراهم می‌کند.[](https://www.logicata.com/blog/amazon-dynamodb-vs-mongodb/)

### داستان‌های مهاجرت یا مقیاس‌پذیری
- **مهاجرت اولیه:** اینستاگرام در ابتدا از پایگاه داده‌های رابطه‌ای استفاده می‌کرد، اما با رشد سریع کاربران، به MongoDB مهاجرت کرد تا انعطاف‌پذیری و مقیاس‌پذیری بیشتری داشته باشد.
- **چالش‌های مقیاس‌پذیری:** با افزایش کاربران (به بیش از ۱ میلیارد کاربر فعال ماهانه)، اینستagram از MongoDB Atlas (سرویس مدیریت‌شده) و شاردینگ برای توزیع بار استفاده کرد.
- **مثال مقیاس‌پذیری:** اینستاگرام از MongoDB برای مدیریت رشد سریع داده‌ها در زمان رویدادهای پرترافیک (مانند پست‌های سلبریتی‌ها) استفاده کرد، که نیاز به شاردینگ و تکرار (Replication) داشت.

---

## درس‌های کلیدی معماری از هر دو شرکت

### درس‌های آمازون و DynamoDB
1. **مقیاس‌پذیری خودکار:** DynamoDB نشان می‌دهد که پارتیشن‌بندی و مقیاس‌پذیری خودکار می‌توانند بارهای کاری غیرقابل پیش‌بینی را مدیریت کنند.
2. **طراحی برای دسترسی‌پذیری:** استفاده از تکرار چندمنطقه‌ای و گره‌های رهبر برای اطمینان از دسترسی‌پذیری بالا.
3. **سادگی عملیات:** مدل بدون سرور DynamoDB پیچیدگی‌های مدیریت زیرساخت را کاهش می‌دهد.
4. **انتخاب کلید پارتیشن:** انتخاب کلید پارتیشن مناسب (مانند UserID یا OrderID) برای توزیع یکنواخت بار حیاتی است.

### درس‌های اینستاگرام و MongoDB
1. **انعطاف‌پذیری طرح‌واره:** مدل مبتنی بر سند امکان توسعه سریع ویژگی‌ها را فراهم می‌کند، که برای برنامه‌های اجتماعی پویا ایده‌آل است.
2. **شاردینگ برای مقیاس‌پذیری:** استفاده از شاردینگ برای مدیریت داده‌های عظیم و توزیع بار.
3. **مدیریت‌شده در مقابل خودمدیریتی:** استفاده از MongoDB Atlas پیچیدگی‌های مدیریت را کاهش داد و به اینستاگرام اجازه داد تا روی توسعه برنامه تمرکز کند.
4. **انعطاف‌پذیری در برابر رشد:** مهاجرت به MongoDB نشان داد که پایگاه‌های داده NoSQL برای برنامه‌های با رشد سریع مناسب‌تر از پایگاه‌های رابطه‌ای هستند.

---

## چه چیزی درباره انتخاب پایگاه داده مناسب برای برنامه‌های مقیاس بزرگ می‌آموزیم؟

انتخاب پایگاه داده مناسب برای برنامه‌های مقیاس بزرگ به عوامل متعددی بستگی دارد:
1. **نیازهای عملکردی:**
   - DynamoDB برای تأخیر تک‌رقمی میلی‌ثانیه‌ای و مقیاس‌پذیری خودکار مناسب است (مانند سبد خرید آمازون).
   - MongoDB برای داده‌های نیمه‌ساختارمند و پرس‌وجوهای پیچیده‌تر مناسب است (مانند متادیتای اینستاگرام).
2. **انعطاف‌پذیری طرح‌واره:**
   - MongoDB برای برنامه‌هایی که نیاز به تغییرات مکرر در مدل داده دارند (مانند اینستاگرام) مناسب‌تر است.
   - DynamoDB برای مدل‌های داده‌ای ساده‌تر کلید-مقدار مناسب است.
3. **مدیریت و هزینه:**
   - DynamoDB به‌عنوان یک سرویس کاملاً مدیریت‌شده، بار عملیاتی را کاهش می‌دهد، اما ممکن است در مقیاس بزرگ گران‌تر باشد.
   - MongoDB (به‌ویژه Atlas) انعطاف‌پذیری بیشتری در میزبانی (ابر، داخلی، یا ترکیبی) ارائه می‌دهد، اما ممکن است نیاز به مدیریت بیشتری داشته باشد.[](https://www.logicata.com/blog/amazon-dynamodb-vs-mongodb/)
4. **ادغام با اکوسیستم:**
   - DynamoDB با سرویس‌های AWS (مانند Lambda، S3) ادغام قوی دارد، که برای برنامه‌های مبتنی بر AWS ایده‌آل است.
   - MongoDB برای استراتژی‌های چندابری (Multi-Cloud) یا محیط‌های غیر AWS مناسب‌تر است.
5. **پیچیدگی پرس‌وجوها:**
   - DynamoDB برای پرس‌وجوهای ساده و مبتنی بر کلید مناسب است، اما برای Join یا پرس‌وجوهای پیچیده نیاز به ابزارهای مکمل دارد.
   - MongoDB از پرس‌وجوهای پیچیده‌تر (مانند Aggregation) پشتیبانی می‌کند.

---

## جدول خلاصه مقایسه موارد استفاده

| **معیار**                     | **آمازون با DynamoDB**                                                                 | **اینستاگرام با MongoDB**                                                             |
|-------------------------------|---------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|
| **پایگاه داده**              | DynamoDB (NoSQL، کلید-مقدار و سند)                                                   | MongoDB (NoSQL، مبتنی بر سند)                                                        |
| **موارد استفاده**            | سبد خرید، پیگیری سفارشات، متادیتای محتوا (Prime Video)                               | متادیتای تصاویر، پروفایل‌های کاربران، فیدهای اجتماعی                               |
| **دلیل انتخاب**              | مقیاس‌پذیری خودکار، تأخیر کم، دسترسی‌پذیری بالا، ادغام با AWS                      | انعطاف‌پذیری طرح‌واره، شاردینگ، پشتیبانی از پرس‌وجوهای پیچیده                    |
| **مقیاس‌پذیری**             | پارتیشن‌بندی خودکار، جداول جهانی برای تکرار چندمنطقه‌ای                              | شاردینگ افقی، پشتیبانی از MongoDB Atlas برای مدیریت مقیاس‌پذیری                    |
| **دسترسی‌پذیری**            | SLA 99.999%، تکرار چندمنطقه‌ای، گره‌های رهبر                                         | تکرار (Replication) و شاردینگ برای دسترسی‌پذیری بالا                                 |
| **عملکرد**                   | تأخیر تک‌رقمی میلی‌ثانیه‌ای، DAX برای کش در حافظه                                   | عملکرد بالا برای پرس‌وجوهای مبتنی بر سند، بهینه برای داده‌های نیمه‌ساختارمند         |
| **تریدآف‌ها**                | عدم پشتیبانی از Join، هزینه بالا در حالت درخواستی                                   | پیچیدگی مدیریت در مقیاس بزرگ (بدون Atlas)، نیاز به طراحی دقیق شاردینگ             |
| **مثال مقیاس‌پذیری**        | ۸۹.۲ میلیون درخواست در ثانیه در Prime Day 2021                                       | مدیریت میلیاردها پست و کاربر با شاردینگ و Atlas                                    |
| **ادغام**                    | ادغام قوی با AWS (Lambda، S3، CloudWatch)                                           | انعطاف‌پذیری در میزبانی (AWS، GCP، داخلی)، ادغام با Atlas                          |

---

## منابع پیشنهادی برای مطالعه بیشتر

1. **آمازون و DynamoDB:**
   - *Amazon DynamoDB: A Scalable, Predictably Performant, and Fully Managed NoSQL Database Service*، USENIX، 2022.[](https://www.usenix.org/conference/atc22/presentation/elhemali)
   - *Amazon DynamoDB: Fast And Scalable NoSQL Database*، Werner Vogels، All Things Distributed، 2012.[](https://www.allthingsdistributed.com/2012/01/amazon-dynamodb.html)
   - *Prime Video Boosts Scale and Resilience Using Amazon DynamoDB*، AWS Database Blog، 2024.[](https://aws.amazon.com/blogs/database/amazon-dynamodb-use-cases-for-media-and-entertainment-customers/)
   - مستندات رسمی AWS: [Amazon DynamoDB Documentation](https://docs.aws.amazon.com/dynamodb/)

2. **اینستاگرام و MongoDB:**
   - *MongoDB Atlas Live Migration Service*، MongoDB Documentation، برای جزئیات مهاجرت.[](https://www.logicata.com/blog/amazon-dynamodb-vs-mongodb/)
   - *AWS DynamoDB vs MongoDB: A NoSQL Comparison*، Logicata، 2020.[](https://www.logicata.com/blog/amazon-dynamodb-vs-mongodb/)
   - مستندات رسمی MongoDB: [MongoDB Atlas](https://www.mongodb.com/docs/atlas/)

3. منابع عمومی:
   - *Designing Data-Intensive Applications* نوشته مارتین کلپمن: کتابی جامع برای یادگیری طراحی پایگاه داده‌های مقیاس‌پذیر.
   - *The System Design Primer* (منبع متن‌باز در GitHub): راهنمایی برای طراحی سیستم‌های مقیاس‌پذیر.
   - دوره‌های آنلاین: *Grokking the System Design Interview* در DesignGuru.io.

---

این سند به‌طور جامع استفاده از DynamoDB در آمازون و MongoDB در اینستاگرام را بررسی کرده و درس‌های کلیدی برای طراحی سیستم‌های مقیاس‌پذیر ارائه می‌دهد. در صورت نیاز به جزئیات بیشتر یا مثال‌های اضافی، لطفاً اطلاع دهید!