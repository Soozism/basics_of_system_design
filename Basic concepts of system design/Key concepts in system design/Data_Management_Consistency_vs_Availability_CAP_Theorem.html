<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مدیریت داده‌ها: سازگاری در مقابل دسترسی‌پذیری (قضیه CAP)</title>
    <link rel="stylesheet" href="../../css/style.css">
    <meta name="description" content="مدیریت داده‌ها: سازگاری در مقابل دسترسی‌پذیری (قضیه CAP)">
    <meta name="keywords" content="طراحی سیستم, مهندسی نرم‌افزار, معماری سیستم">
</head>
<body>
    <header>
        <div class="header-content">
            <a href="../../index.html" class="logo">طراحی سیستم</a>
            <nav>
                <ul class="nav-menu">
                    <li><a href="../../index.html">خانه</a></li>
                    <li><a href="../../index.html#basic-concepts">مفاهیم پایه</a></li>
                    <li><a href="../../index.html#main-components">اجزای اصلی</a></li>
                    <li><a href="../../index.html#scalable-systems">سیستم‌های مقیاس‌پذیر</a></li>
                    <li><a href="../../index.html#advanced-topics">موضوعات پیشرفته</a></li>
                    <li><a href="../../index.html#interviews">مصاحبه</a></li>
                </ul>
            </nav>
            <button class="mobile-menu-toggle">☰</button>
        </div>
    </header>

    <div class="container">
        <main class="main-content">
            <aside class="sidebar">
                
    <h3>مدیریت داده‌ها: سازگاری در مقابل دسترسی‌پذیری (قضیه CAP)</h3>
    <ul>
        <li><a href="../../../index.html">بازگشت به خانه</a></li>
        <li><a href="../../../index.html#basic-concepts">مفاهیم پایه</a></li>
        <li><a href="../../../index.html#main-components">اجزای اصلی</a></li>
        <li><a href="../../../index.html#scalable-systems">سیستم‌های مقیاس‌پذیر</a></li>
        <li><a href="../../../index.html#advanced-topics">موضوعات پیشرفته</a></li>
        <li><a href="../../../index.html#interviews">آمادگی مصاحبه</a></li>
    </ul>
    
            </aside>

            <article class="content">
                <div class="breadcrumb">
                    <a href="index.html">خانه</a>
<span>/</span>
<span>Basic concepts of system design</span>
<span>/</span>
<span>Key concepts in system design</span>
<span>/</span>
<span>Data_Management_Consistency_vs_Availability_CAP_Theorem.html</span>
                </div>

                <h1>مدیریت داده‌ها: سازگاری در مقابل دسترسی‌پذیری (قضیه CAP)</h1>

<p>این سند به بررسی مفاهیم سازگاری (Consistency) و دسترسی‌پذیری (Availability) در سیستم‌های توزیع‌شده با تمرکز بر <strong>قضیه CAP</strong> می‌پردازد. هدف این است که با ارائه تعاریف، توضیح قضیه، مثال‌های عملی، تریدآف‌ها، دیاگرام‌ها و منابع پیشنهادی، یک راهنمای جامع و آموزشی برای یادگیری عمیق فراهم شود. این محتوا به زبان فارسی و با فرمت مارک‌داون ارائه شده است تا برای مستندسازی آموزشی و یادگیری اصول طراحی سیستم مناسب باشد.</p>

<p>---</p>

<h2>مقدمه: سازگاری و دسترسی‌پذیری در سیستم‌های توزیع‌شده چیست؟</h2>

<p>در سیستم‌های توزیع‌شده، که داده‌ها و پردازش‌ها بین چندین سرور یا گره (Node) تقسیم می‌شوند، دو ویژگی کلیدی برای مدیریت داده‌ها وجود دارد:</p>

<ul><li><strong>سازگاری (Consistency):</strong> به این معناست که تمام گره‌های سیستم در هر لحظه داده‌های یکسانی را ارائه می‌دهند. به عبارت دیگر، هر خواندن از سیستم باید آخرین نسخه داده‌ها را بازگرداند.</li></ul>
  - <strong>مثال:</strong> در یک سیستم بانکی، موجودی حساب کاربر باید در همه سرورها یکسان باشد.
<ul><li><strong>دسترسی‌پذیری (Availability):</strong> به این معناست که سیستم همیشه به درخواست‌های کاربران پاسخ می‌دهد، حتی در صورت بروز خطا یا خرابی در برخی گره‌ها.</li></ul>
  - <strong>مثال:</strong> یک وب‌سایت تجارت الکترونیک باید حتی در صورت خرابی یک سرور، همچنان در دسترس باشد.

<p>این دو ویژگی در سیستم‌های مقیاس بزرگ (مانند پایگاه‌های داده توزیع‌شده یا پلتفرم‌های وب) حیاتی هستند، اما دستیابی به هر دو به‌طور همزمان چالش‌برانگیز است. <strong>قضیه CAP</strong> چارچوبی برای درک این چالش و انتخاب بین سازگاری و دسترسی‌پذیری ارائه می‌دهد.</p>

<p>---</p>

<h2>قضیه CAP چیست؟ توضیح کامل سازگاری، دسترسی‌پذیری و تحمل تقسیم‌بندی</h2>

<strong>قضیه CAP</strong> (Consistency, Availability, Partition Tolerance) که توسط اریک بروئر (Eric Brewer) در سال 2000 مطرح شد و بعداً توسط دیگران اثبات شد، بیان می‌کند که یک سیستم توزیع‌شده نمی‌تواند به‌طور همزمان هر سه ویژگی زیر را به‌طور کامل تضمین کند:

<ul><li><strong>سازگاری (Consistency):</strong></li></ul>
   - هر عملیات خواندن از سیستم آخرین نسخه داده‌های نوشته‌شده را بازمی‌گرداند (یا خطا می‌دهد).
   - <strong>مثال:</strong> اگر کاربری موجودی حساب خود را به‌روزرسانی کند، تمام خواندن‌های بعدی باید مقدار جدید را نشان دهند.
   - <strong>انواع سازگاری:</strong>
     - <strong>سازگاری قوی (Strong Consistency):</strong> تمام گره‌ها در لحظه یکسان داده‌های یکسانی دارند.
     - <strong>سازگاری نهایی (Eventual Consistency):</strong> گره‌ها ممکن است موقتاً داده‌های متفاوتی داشته باشند، اما در نهایت به همگرایی می‌رسند.

<ul><li><strong>دسترسی‌پذیری (Availability):</strong></li></ul>
   - هر درخواست (خواندن یا نوشتن) به یک گره غیرخراب در سیستم، همیشه پاسخی دریافت می‌کند (بدون تضمین اینکه پاسخ شامل آخرین داده‌ها باشد).
   - <strong>مثال:</strong> حتی اگر برخی سرورها از کار بیفتند، سیستم همچنان به درخواست‌ها پاسخ می‌دهد.

<ul><li><strong>تحمل تقسیم‌بندی (Partition Tolerance):</strong></li></ul>
   - سیستم حتی در صورت بروز <strong>تقسیم‌بندی شبکه</strong> (Network Partition)، که در آن ارتباط بین برخی گره‌ها قطع می‌شود، به کار خود ادامه می‌دهد.
   - <strong>مثال:</strong> اگر ارتباط بین دو مرکز داده قطع شود، سیستم باید بتواند به‌طور مستقل در هر بخش عمل کند.
   - در سیستم‌های توزیع‌شده، تقسیم‌بندی شبکه به دلیل خرابی‌های شبکه اجتناب‌ناپذیر است، بنابراین تحمل تقسیم‌بندی معمولاً الزامی است.

<p>---</p>

<h2>تعریف رسمی قضیه CAP و پیامدهای آن</h2>

<strong>تعریف رسمی:</strong> قضیه CAP بیان می‌کند که در یک سیستم توزیع‌شده که با تقسیم‌بندی شبکه مواجه است، تنها می‌توان <strong>دو ویژگی از سه ویژگی سازگاری، دسترسی‌پذیری و تحمل تقسیم‌بندی</strong> را به‌طور همزمان تضمین کرد. به عبارت دیگر، سیستم باید بین یکی از ترکیب‌های زیر انتخاب کند:
<ul><li><strong>CP (سازگار و تحمل تقسیم‌بندی):</strong> سیستم داده‌های سازگار ارائه می‌دهد، اما ممکن است در زمان تقسیم‌بندی شبکه، دسترسی‌پذیری را از دست بدهد.</li></ul>
<ul><li><strong>AP (دسترسی‌پذیر و تحمل تقسیم‌بندی):</strong> سیستم همیشه در دسترس است، اما ممکن است داده‌های ناسازگار ارائه دهد.</li></ul>
<ul><li><strong>CA (سازگار و دسترسی‌پذیر):</strong> سیستم داده‌های سازگار ارائه می‌دهد و همیشه در دسترس است، اما تنها در محیط‌هایی که تقسیم‌بندی شبکه وجود ندارد (که در سیستم‌های توزیع‌شده واقعی نادر است).</li></ul>

<strong>پیامدها:</strong>
<ul><li>در دنیای واقعی، تقسیم‌بندی شبکه (مانند قطعی ارتباط بین سرورها) اجتناب‌ناپذیر است، بنابراین سیستم‌ها باید تحمل تقسیم‌بندی (P) را بپذیرند.</li></ul>
<ul><li>این به این معناست که طراحی سیستم باید بین <strong>سازگاری (C)</strong> و <strong>دسترسی‌پذیری (A)</strong> تریدآف کند.</li></ul>
<ul><li>انتخاب بین CP یا AP به نیازهای برنامه و مورد استفاده (Use Case) بستگی دارد.</li></ul>

<p>---</p>

<h2>چرا هر سه ویژگی (C، A، P) نمی‌توانند به‌طور همزمان محقق شوند؟</h2>

<p>در یک سیستم توزیع‌شده، زمانی که تقسیم‌بندی شبکه رخ می‌دهد (یعنی برخی گره‌ها نمی‌توانند با یکدیگر ارتباط برقرار کنند)، سیستم باید یکی از دو تصمیم زیر را بگیرد:
<ul><li><strong>توقف پاسخ‌گویی برای حفظ سازگاری (CP):</strong> سیستم درخواست‌ها را تا زمانی که داده‌ها در همه گره‌ها همگام شوند، رد می‌کند. این کار دسترسی‌پذیری را کاهش می‌دهد.</li></ul>
<ul><li><strong>ادامه پاسخ‌گویی با داده‌های ناسازگار (AP):</strong> سیستم به درخواست‌ها پاسخ می‌دهد، حتی اگر داده‌ها در گره‌های مختلف متفاوت باشند. این کار سازگاری را قربانی می‌کند.</li></ul></p>

<strong>مثال ساده:</strong>
<ul><li>فرض کنید یک سیستم بانکی با دو سرور (A و B) دارید. کاربری 100 دلار از حساب خود برداشت می‌کند و این تغییر در سرور A ثبت می‌شود، اما به دلیل تقسیم‌بندی شبکه، سرور B هنوز موجودی قدیمی را نشان می‌دهد.</li></ul>
  - <strong>CP:</strong> سیستم درخواست‌های خواندن از سرور B را رد می‌کند تا از ارائه داده‌های ناسازگار جلوگیری کند (کاهش دسترسی‌پذیری).
  - <strong>AP:</strong> سیستم به سرور B اجازه می‌دهد موجودی قدیمی را نشان دهد (کاهش سازگاری).

<p>چون نمی‌توان از تقسیم‌بندی شبکه جلوگیری کرد، دستیابی به هر سه ویژگی به‌طور همزمان غیرممکن است.</p>

<p>---</p>

<h2>مثال‌های عملی از سیستم‌هایی با اولویت‌های مختلف</h2>

<h3>۱. سیستم‌های CP (سازگار و تحمل تقسیم‌بندی)</h3>
<ul><li><strong>ویژگی‌ها:</strong> اولویت با ارائه داده‌های سازگار است، حتی اگر به معنای کاهش دسترسی‌پذیری در زمان تقسیم‌بندی باشد.</li></ul>
<ul><li><strong>مثال‌ها:</strong></li></ul>
  - <strong>MongoDB (در حالت پیش‌فرض):</strong> در تنظیمات با Write Concern بالا، MongoDB سازگاری قوی را تضمین می‌کند، اما ممکن است در زمان تقسیم‌بندی، درخواست‌ها را رد کند.
  - <strong>HBase:</strong> پایگاه داده‌ای که برای سازگاری قوی طراحی شده و در صورت تقسیم‌بندی، دسترسی‌پذیری را قربانی می‌کند.
<ul><li><strong>مورد استفاده:</strong> سیستم‌های مالی (مانند بانکداری) که نیاز به داده‌های کاملاً سازگار دارند.</li></ul>

<h3>۲. سیستم‌های AP (دسترسی‌پذیر و تحمل تقسیم‌بندی)</h3>
<ul><li><strong>ویژگی‌ها:</strong> اولویت با دسترسی‌پذیری است، حتی اگر به معنای ارائه داده‌های ناسازگار موقت باشد (معمولاً با سازگاری نهایی).</li></ul>
<ul><li><strong>مثال‌ها:</strong></li></ul>
  - <strong>Amazon DynamoDB:</strong> پایگاه داده NoSQL که دسترسی‌پذیری بالا و سازگاری نهایی را ارائه می‌دهد.
  - <strong>Cassandra:</strong> پایگاه داده‌ای که برای دسترسی‌پذیری بالا طراحی شده و از سازگاری نهایی پشتیبانی می‌کند.
<ul><li><strong>مورد استفاده:</strong> شبکه‌های اجتماعی، فروشگاه‌های آنلاین یا سیستم‌های تحمل‌پذیر خطا که داده‌های ناسازگار موقت قابل قبول هستند.</li></ul>

<h3>۳. سیستم‌های CA (سازگار و دسترسی‌پذیر)</h3>
<ul><li><strong>ویژگی‌ها:</strong> این سیستم‌ها در محیط‌هایی که تقسیم‌بندی شبکه وجود ندارد (مانند سیستم‌های تک‌سروری یا شبکه‌های محلی قابل اعتماد) کار می‌کنند.</li></ul>
<ul><li><strong>مثال‌ها:</strong></li></ul>
  - <strong>پایگاه‌های داده رابطه‌ای سنتی (مانند MySQL یا PostgreSQL):</strong> در حالت تک‌سروری، این پایگاه‌ها سازگاری و دسترسی‌پذیری را ارائه می‌دهند.
  - <strong>سیستم‌های محلی:</strong> مانند سیستم‌های مدیریت موجودی در یک فروشگاه کوچک.
<ul><li><strong>مورد استفاده:</strong> برنامه‌هایی که در محیط‌های بدون تقسیم‌بندی شبکه اجرا می‌شوند (نادر در سیستم‌های توزیع‌شده واقعی).</li></ul>

<p>---</p>

<h2>تریدآف‌های واقعی که توسعه‌دهندگان در طراحی سیستم‌های توزیع‌شده باید در نظر بگیرند</h2>

<ul><li><strong>سازگاری در مقابل تجربه کاربری:</strong></li></ul>
   - سیستم‌های CP ممکن است در زمان تقسیم‌بندی شبکه، درخواست‌ها را رد کنند، که می‌تواند تجربه کاربری را مختل کند.
   - سیستم‌های AP ممکن است داده‌های ناسازگار ارائه دهند، که در برخی موارد (مانند موجودی حساب بانکی) غیرقابل قبول است.
   - <strong>مثال:</strong> در آمازون، سبد خرید کاربران ممکن است موقتاً ناسازگار باشد (AP)، اما سیستم بانکی باید همیشه سازگار باشد (CP).

<ul><li><strong>پیچیدگی طراحی:</strong></li></ul>
   - سیستم‌های CP نیاز به مکانیزم‌های هماهنگی پیچیده (مانند پروتکل‌های اجماع) دارند.
   - سیستم‌های AP ساده‌تر هستند، اما نیاز به مدیریت ناسازگاری‌های موقت دارند.

<ul><li><strong>هزینه و کارایی:</strong></li></ul>
   - سیستم‌های CP معمولاً تأخیر بیشتری دارند، زیرا نیاز به همگام‌سازی داده‌ها در گره‌ها دارند.
   - سیستم‌های AP کارایی بهتری دارند، اما ممکن است نیاز به ابزارهای اضافی برای مدیریت سازگاری نهایی داشته باشند.

<ul><li><strong>نیازهای تجاری:</strong></li></ul>
   - در برخی موارد، دسترسی‌پذیری (مانند وب‌سایت‌های تجارت الکترونیک) مهم‌تر از سازگاری است.
   - در موارد دیگر، سازگاری (مانند سیستم‌های مالی) حیاتی‌تر است.

<p>---</p>

<h2>چگونه بین سازگاری و دسترسی‌پذیری انتخاب کنیم؟</h2>

<p>انتخاب بین سازگاری و دسترسی‌پذیری به مورد استفاده و نیازهای برنامه بستگی دارد:</p>

<ul><li><strong>مواردی که سازگاری اولویت دارد (CP):</strong></li></ul>
   - <strong>سیستم‌های مالی:</strong> مانند تراکنش‌های بانکی که داده‌های ناسازگار می‌توانند به خسارات مالی منجر شوند.
   - <strong>سیستم‌های رزرو:</strong> مانند رزرو بلیط هواپیما که نباید دو نفر یک صندلی را رزرو کنند.
   - <strong>مثال فناوری:</strong> MongoDB با تنظیمات Write Concern بالا، یا Spanner گوگل.

<ul><li><strong>مواردی که دسترسی‌پذیری اولویت دارد (AP):</strong></li></ul>
   - <strong>شبکه‌های اجتماعی:</strong> مانند فیسبوک یا توییتر، که ناسازگاری موقت (مانند تأخیر در نمایش پست‌ها) قابل قبول است.
   - <strong>فروشگاه‌های آنلاین:</strong> مانند آمازون، که دسترسی‌پذیری سبد خرید مهم‌تر از سازگاری لحظه‌ای است.
   - <strong>مثال فناوری:</strong> Cassandra، DynamoDB.

<ul><li><strong>موارد ترکیبی:</strong></li></ul>
   - برخی سیستم‌ها از تنظیمات ترکیبی استفاده می‌کنند (مانند DynamoDB با گزینه‌های سازگاری قوی برای برخی عملیات).
   - <strong>مثال:</strong> یک سیستم تجارت الکترونیک ممکن است برای سبد خرید از AP و برای پرداخت از CP استفاده کند.

<strong>نکته کلیدی:</strong> توسعه‌دهندگان باید نیازهای برنامه (مانند تحمل ناسازگاری یا نیاز به دسترسی‌پذیری بالا) را تحلیل کرده و معماری مناسب را انتخاب کنند.

<p>---</p>

<h2>دیاگرام‌ها و جداول</h2>

<h3>دیاگرام مثلث CAP</h3>

<pre><code>
       C (سازگاری)
      / \
     /   \
    /     \
   A-------P
(دسترسی‌پذیری) (تحمل تقسیم‌بندی)
</code></pre>

<strong>توضیح:</strong>
<ul><li>مثلث CAP نشان می‌دهد که یک سیستم توزیع‌شده تنها می‌تواند دو ضلع از سه ضلع را انتخاب کند.</li></ul>
<ul><li>در دنیای واقعی، P (تحمل تقسیم‌بندی) اجتناب‌ناپذیر است، بنابراین انتخاب بین C و A انجام می‌شود.</li></ul>

<h3>جدول مقایسه سیستم‌های CP، AP و CA</h3>

<p><td> <strong>نوع سیستم</strong> </td> <strong>ویژگی‌ها</strong>                                                                 <td> <strong>مثال‌ها</strong>                     </td> <strong>موارد استفاده</strong>                       |
<td>---------------</td>------------------------------------------------------------------------------<td>---------------------------------</td>-----------------------------------------|
<td> <strong>CP</strong>        </td> سازگاری قوی، کاهش دسترسی‌پذیری در زمان تقسیم‌بندی                          <td> MongoDB، HBase، Spanner        </td> سیستم‌های مالی، رزرو                    |
<td> <strong>AP</strong>        </td> دسترسی‌پذیری بالا، سازگاری نهایی یا ناسازگاری موقت                        <td> DynamoDB، Cassandra             </td> شبکه‌های اجتماعی، فروشگاه‌های آنلاین   |
<td> <strong>CA</strong>        </td> سازگاری و دسترسی‌پذیری بالا، اما تنها بدون تقسیم‌بندی شبکه                 <td> MySQL (تک‌سروری)، PostgreSQL   </td> سیستم‌های محلی، غیرتوزیع‌شده           |</p>

<p>---</p>

<h2>خلاصه و بهترین روش‌ها برای اعمال قضیه CAP در طراحی سیستم</h2>

<ul><li><strong>قضیه CAP</strong> چارچوبی برای درک تریدآف‌ها بین سازگاری، دسترسی‌پذیری و تحمل تقسیم‌بندی در سیستم‌های توزیع‌شده ارائه می‌دهد.</li></ul>
<ul><li><strong>پیامد کلیدی:</strong> در سیستم‌های توزیع‌شده واقعی، تقسیم‌بندی شبکه اجتناب‌ناپذیر است، بنابراین باید بین سازگاری (C) و دسترسی‌پذیری (A) انتخاب کرد.</li></ul>
<ul><li><strong>بهترین روش‌ها:</strong></li></ul>
  - <strong>تحلیل نیازهای برنامه:</strong> مشخص کنید که آیا سازگاری (مانند سیستم‌های مالی) یا دسترسی‌پذیری (مانند شبکه‌های اجتماعی) اولویت دارد.
  - <strong>انتخاب فناوری مناسب:</strong> از پایگاه‌های داده‌ای مانند DynamoDB برای AP یا Spanner برای CP استفاده کنید.
  - <strong>مدیریت ناسازگاری:</strong> در سیستم‌های AP، از مکانیزم‌هایی مانند CRDT (Conflict-Free Replicated Data Types) برای مدیریت سازگاری نهایی استفاده کنید.
  - <strong>مانیتورینگ و تست:</strong> از ابزارهایی مانند Chaos Monkey برای تست تحمل تقسیم‌بندی استفاده کنید.
  - <strong>طراحی ترکیبی:</strong> برای برخی عملیات حیاتی از CP و برای عملیات غیرحیاتی از AP استفاده کنید.
<ul><li><strong>درس کلیدی:</strong> قضیه CAP به توسعه‌دهندگان کمک می‌کند تا با درک تریدآف‌ها، سیستم‌هایی طراحی کنند که با نیازهای برنامه هم‌راستا باشند.</li></ul>

<p>---</p>

<h2>منابع پیشنهادی برای مطالعه بیشتر</h2>

<ul><li><em>Designing Data-Intensive Applications</em> نوشته مارتین کلپمن: کتابی جامع برای یادگیری قضیه CAP و طراحی سیستم‌های توزیع‌شده.</li></ul>
<ul><li><em>The System Design Primer</em> (منبع متن‌باز در GitHub): راهنمایی برای درک CAP و معماری‌های توزیع‌شده.</li></ul>
<ul><li>وبلاگ‌های مهندسی:</li></ul>
   - <em>AWS Architecture Blog</em>: مقالات در مورد DynamoDB و مدیریت تریدآف‌های CAP.
   - <em>Netflix Tech Blog</em>: توضیحات در مورد استفاده از Cassandra و AP.
   - <em>Google Cloud Blog</em>: مقالات در مورد Spanner و سازگاری قوی.
<ul><li>دوره‌های آنلاین:</li></ul>
   - <em>Grokking the System Design Interview</em> در DesignGuru.io
   - <em>System Design Course</em> در Educative.io
<ul><li>مقالات اصلی:</li></ul>
   - "Brewer’s Conjecture and the Feasibility of Consistent, Available, Partition-Tolerant Web Services" توسط اریک بروئر.

<p>---</p>

<p>این سند مفهوم سازگاری، دسترسی‌پذیری و قضیه CAP را به‌صورت جامع توضیح می‌دهد و برای مستندسازی آموزشی و یادگیری طراحی سیستم مناسب است. در صورت نیاز به توضیحات عمیق‌تر یا مثال‌های بیشتر، لطفاً اطلاع دهید!</p>

                <div class="alert alert-info" style="margin-top: 2rem;">
                    <strong>نکته:</strong> این مطلب بخشی از مجموعه آموزش طراحی سیستم است. برای مطالعه سایر مطالب، از منوی کناری استفاده کنید.
                </div>
            </article>
        </main>
    </div>

    <footer>
        <div class="footer-content">
            <p>&copy; 2024 آموزش طراحی سیستم - تمام حقوق محفوظ است</p>
            <p>آخرین به‌روزرسانی: 2025-07-12</p>
        </div>
    </footer>

    <script src="../../js/script.js"></script>
</body>
</html>